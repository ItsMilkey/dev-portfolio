---
// Theme toggle script
---

<script is:inline>
    // Initialize theme from localStorage or system preference
    function initTheme() {
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
            "(prefers-color-scheme: dark)",
        ).matches;
        const theme = savedTheme || (prefersDark ? "dark" : "light");

        // Apply theme immediately to prevent flash
        document.documentElement.setAttribute("data-theme", theme);
        document.documentElement.classList.add("no-transition");

        // Remove no-transition class after a brief delay
        setTimeout(() => {
            document.documentElement.classList.remove("no-transition");
        }, 100);
    }

    // Run immediately
    initTheme();

    // Toggle theme function
    window.toggleTheme = function () {
        const currentTheme =
            document.documentElement.getAttribute("data-theme") || "light";
        const newTheme = currentTheme === "light" ? "dark" : "light";

        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);

        // Update toggle button state
        updateToggleButton(newTheme);
    };

    // Update toggle button appearance
    function updateToggleButton(theme) {
        const toggles = document.querySelectorAll(".theme-toggle-switch");
        toggles.forEach((toggle) => {
            const indicator = toggle.querySelector(".theme-toggle-indicator");
            if (indicator) {
                if (theme === "dark") {
                    indicator.style.transform = "translateX(20px)";
                } else {
                    indicator.style.transform = "translateX(2px)";
                }
            }
        });
    }

    // Listen for system theme changes
    window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", (e) => {
            if (!localStorage.getItem("theme")) {
                const theme = e.matches ? "dark" : "light";
                document.documentElement.setAttribute("data-theme", theme);
                updateToggleButton(theme);
            }
        });

    // Initialize toggle button on load
    document.addEventListener("DOMContentLoaded", () => {
        const currentTheme =
            document.documentElement.getAttribute("data-theme") || "light";
        updateToggleButton(currentTheme);
    });
</script>
